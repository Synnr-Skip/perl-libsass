language: perl
compiler:
  - clang
  - gcc
perl:
   - "5.20"
   - "5.18"
   - "5.16"
   - "5.14"
   - "5.12"

before_install:
   - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
   - sudo apt-get update -qq
   - sudo apt-get install -qq g++-4.8
   - sudo rm /usr/bin/gcc
   - sudo rm /usr/bin/g++
   - sudo rm /usr/bin/gcov
   - sudo ln -s /usr/bin/gcc-4.8 /usr/bin/gcc
   - sudo ln -s /usr/bin/g++-4.8 /usr/bin/g++
   - sudo ln -s /usr/bin/gcov-4.8 /usr/bin/gcov
   - git submodule update --init --recursive
   - cpanm Devel::Cover
   - cpanm -n Devel::Cover::Report::Coveralls
install:
   # Deal with all of the dependencies, quickly and quietly
   - cpanm --quiet --notest --skip-satisfied Class::Accessor::Fast
before_script:
   # initialize libsass, sass2scss and sass-spec
   # - git submodule update --init --recursive
script:
   - perl Build.PL cover=1
   - ./Build verbose=1
   - HARNESS_PERL_SWITCHES=-MDevel::Cover ./Build test verbose=1
   - ./Build install verbose=1
after_success:
   - find -name *.gcda -type f -exec gcov-4.8 -abc -o `basename {}` {} \;
   - cover -gcov -report coveralls -ignore_re "^/usr"
